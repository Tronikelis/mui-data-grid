import{jsxs as t,jsx as e,Fragment as i}from"react/jsx-runtime";import{useRef as o,useEffect as n,useState as r,useCallback as s,memo as c}from"react";import{Box as d,IconButton as l,Button as a,TableRow as m,TableCell as v,TableContainer as u,Table as p,TableHead as h,TableSortLabel as f,TableBody as x,LinearProgress as g}from"@mui/material";import{dequal as b}from"dequal";import{useCustomCompareEffect as j}from"use-custom-compare";import{Virtuoso as w}from"react-virtuoso";import O from"zustand";import y from"immer";import S from"@mui/icons-material/Add";import C from"@mui/icons-material/Remove";import D from"@mui/icons-material/ImportExport";import{CSVLink as z}from"react-csv";import k from"@mui/icons-material/RestartAlt";const B=O((I=t=>({state:{rows:[],fontSize:1,sortDirection:!1,sortBy:""},actions:{setFontSize:e=>t((t=>{t.state.fontSize=e(t.state.fontSize)})),setSortDirection:()=>t((t=>{t.state.sortDirection=!t.state.sortDirection})),setSortBy:e=>t((t=>{t.state.sortBy=e})),setRows:e=>t((t=>{t.state.rows=e}))}}),(t,e,i)=>I(((e,i)=>{const o="function"==typeof e?y(e):e;return t(o,i)}),e,i)));var I;function R(){const{setFontSize:i}=B((t=>t.actions));return t(d,Object.assign({sx:{display:"flex",justifyContent:"space-around",alignItems:"center"}},{children:[e(l,Object.assign({onClick:()=>{i((t=>t+.1))}},{children:e(S,{},void 0)}),void 0),e(l,Object.assign({onClick:()=>{i((t=>t-.1))}},{children:e(C,{},void 0)}),void 0)]}),void 0)}function T(){const t=o(B.getState().state.rows);return n((()=>B.subscribe((e=>t.current=e.state.rows))),[]),e(d,{children:e(z,Object.assign({data:t.current,filename:"data-table-export",style:{textDecoration:"none"}},{children:e(a,Object.assign({variant:"text",endIcon:e(D,{},void 0),color:"primary"},{children:"Export"}),void 0)}),void 0)},void 0)}function F(){const{setSortBy:t,setRows:i,setFontSize:o}=B((t=>t.actions));return e(l,Object.assign({onClick:()=>{t(""),o((()=>1)),L&&i(L)}},{children:e(k,{},void 0)}),void 0)}const M={cursor:"pointer",color:"#1b4394"};function A(o){const{lines:c=3,obj:d,lessText:l="Less",moreText:a="More"}=o,[m,v]=r(""),[u,p]=r(!0),[h,f]=r(null),x=s((t=>{if(!t)return;t.getClientRects().length<=c||f(Math.ceil(t.innerText.length/c))}),[c]);return n((()=>{E(d)&&v(d)}),[d]),m?t("span",Object.assign({ref:x},{children:[u&&h?m.substring(0,h):m,e("span",Object.assign({onClick:()=>p((t=>!t)),style:M},{children:h&&e(i,{children:u?"... "+a:"... "+l},void 0)}),void 0)]}),void 0):d}const E=t=>"[object String]"===Object.prototype.toString.call(t),q=c((t=>{const{columns:o,row:n,index:r,truncate:s}=t,c=B((t=>t.state.fontSize)),d=(t,o)=>{var s,c,d;return o?e(i,{children:o({index:r,data:null!==(s=null==n?void 0:n[t])&&void 0!==s?s:""})},void 0):null!==(d=null===(c=null==n?void 0:n[t])||void 0===c?void 0:c.toString())&&void 0!==d?d:""};return e("div",Object.assign({style:{width:"100%",height:"100%"}},{children:e(m,Object.assign({sx:{display:"flex"},component:"div",hover:!0},{children:o.map((({field:t,flex:o,width:n,renderCell:r},l)=>e(v,Object.assign({component:"div",sx:{flex:n||o?o:1,width:n,wordBreak:"break-word"}},{children:e("div",Object.assign({style:{fontSize:`${c}em`}},{children:s?e(A,Object.assign({obj:d(t,r)},s),void 0):e(i,{children:d(t,r)},void 0)}),void 0)}),l)))}),void 0)}),void 0)}));let L=null;var N=c((function(i){const{columns:r,rows:s,component:c,loading:l,sx:a,overscanCount:g=0,truncateText:O}=i,{rows:y,sortBy:S,sortDirection:C}=B((t=>t.state)),{setRows:D,setSortBy:z,setSortDirection:k}=B((t=>t.actions)),I=o(null);return j((()=>{D(s)}),[s],b),n((()=>{L=s}),[]),t(u,Object.assign({component:null!=c?c:"div",sx:{height:"100%",width:"100%",display:"flex",flexDirection:"column"}},{children:[e(W,{},void 0),t(p,Object.assign({sx:{minWidth:"300px",display:"flex",flexDirection:"column",width:"100%",height:"100%",...a},component:"div"},{children:[e(h,Object.assign({component:"div"},{children:e(m,Object.assign({sx:{display:"flex"},component:"div"},{children:r.map((({field:t,flex:i,width:o,headerName:n})=>e(v,Object.assign({sx:{flex:o||i?i:1,width:o,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},component:"div"},{children:e(d,Object.assign({sx:{display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%"}},{children:e(f,Object.assign({active:S===t,direction:C?"asc":"desc",onClick:()=>{((t,e)=>{var i;z(e),D(t?[...s].sort(((t,i)=>t[e]<i[e]?-1:i[e]<t[e]?1:0)):[...s].sort(((t,i)=>t[e]<i[e]?1:i[e]<t[e]?-1:0))),null===(i=I.current)||void 0===i||i.scrollToIndex({index:0})})(!C,t),k()}},{children:n.toString()}),void 0)}),void 0)}),t)))}),void 0)}),void 0),t(x,Object.assign({sx:{width:"100%",height:"100%",position:"relative"},component:"div"},{children:[l&&e($,{},void 0),e(w,{height:"100%",width:"100%",ref:I,data:y,overscan:g,itemContent:(t,i)=>e(q,{columns:r,row:i,index:t,truncate:O},void 0)},void 0)]}),void 0)]}),void 0)]}),void 0)}),b);function W(){return t(d,Object.assign({sx:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",p:"5px"}},{children:[e(T,{},void 0),e(R,{},void 0),e(F,{},void 0)]}),void 0)}function $(){return e(g,{sx:{position:"absolute",top:"0px",width:"100%"}},void 0)}export{N as MuiDataTable};
