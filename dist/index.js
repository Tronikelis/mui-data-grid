import{jsxs as t,jsx as i,Fragment as e}from"react/jsx-runtime";import{useRef as o,useEffect as n,useState as r,useCallback as s,memo as c}from"react";import{Box as d,IconButton as l,Button as a,TableRow as m,TableCell as v,TableContainer as u,Table as p,TableHead as f,TableSortLabel as h,TableBody as x,LinearProgress as g}from"@mui/material";import{dequal as b}from"dequal";import{useCustomCompareEffect as j}from"use-custom-compare";import{Virtuoso as w}from"react-virtuoso";import O from"zustand";import y from"immer";import S from"@mui/icons-material/Add";import C from"@mui/icons-material/Remove";import D from"@mui/icons-material/ImportExport";import{CSVLink as z}from"react-csv";import k from"@mui/icons-material/RestartAlt";const B=O((I=t=>({state:{rows:[],fontSize:1,sortDirection:!1,sortBy:""},actions:{setFontSize:i=>t((t=>{t.state.fontSize=i(t.state.fontSize)})),setSortDirection:()=>t((t=>{t.state.sortDirection=!t.state.sortDirection})),setSortBy:i=>t((t=>{t.state.sortBy=i})),setRows:i=>t((t=>{t.state.rows=i}))}}),(t,i,e)=>I(((i,e)=>{const o="function"==typeof i?y(i):i;return t(o,e)}),i,e)));var I;function R(){const{setFontSize:e}=B((t=>t.actions));return t(d,Object.assign({sx:{display:"flex",justifyContent:"space-around",alignItems:"center"}},{children:[i(l,Object.assign({onClick:()=>{e((t=>t+.1))}},{children:i(S,{},void 0)}),void 0),i(l,Object.assign({onClick:()=>{e((t=>t-.1))}},{children:i(C,{},void 0)}),void 0)]}),void 0)}function T(){const t=o(B.getState().state.rows);return n((()=>B.subscribe((i=>t.current=i.state.rows))),[]),i(d,{children:i(z,Object.assign({data:t.current,filename:"data-table-export",style:{textDecoration:"none"}},{children:i(a,Object.assign({variant:"text",endIcon:i(D,{},void 0),color:"primary"},{children:"Export"}),void 0)}),void 0)},void 0)}function F(){const{setSortBy:t,setRows:e,setFontSize:o}=B((t=>t.actions));return i(l,Object.assign({onClick:()=>{t(""),o((()=>1)),L&&e(L)}},{children:i(k,{},void 0)}),void 0)}const M={cursor:"pointer",color:"#1b4394"};function A(o){const{lines:c=3,obj:d,lessText:l="Less",moreText:a="More"}=o,[m,v]=r(""),[u,p]=r(!0),[f,h]=r(null),x=s((t=>{if(!t)return;t.getClientRects().length<=c||h(Math.ceil(t.innerText.length/c))}),[c]);return n((()=>{E(d)&&v(d)}),[d]),m?t("span",Object.assign({ref:x},{children:[u&&f?m.substring(0,f):m,i("span",Object.assign({onClick:()=>p((t=>!t)),style:M},{children:f&&i(e,{children:u?"... "+a:"... "+l},void 0)}),void 0)]}),void 0):d}const E=t=>"[object String]"===Object.prototype.toString.call(t),q=c((t=>{const{columns:o,row:n,index:r,truncate:s}=t,c=B((t=>t.state.fontSize)),d=(t,o)=>{var s,c;return o?i(e,{children:o({index:r,data:null!==(s=null==n?void 0:n[t])&&void 0!==s?s:""})},void 0):null===(c=null==n?void 0:n[t])||void 0===c?void 0:c.toString()};return i("div",Object.assign({style:{width:"100%",height:"100%"}},{children:i(m,Object.assign({sx:{display:"flex"},component:"div",hover:!0},{children:o.map((({field:t,flex:o,width:n,renderCell:r},l)=>i(v,Object.assign({component:"div",sx:{flex:n||o?o:1,width:n,wordBreak:"break-word"}},{children:i("div",Object.assign({style:{fontSize:`${c}em`}},{children:s?i(A,Object.assign({obj:d(t,r)},s),void 0):i(e,{children:d(t,r)},void 0)}),void 0)}),l)))}),void 0)}),void 0)}));let L=null;var W=c((function(e){const{columns:r,rows:s,component:c,loading:l,sx:a,overscanCount:g=0,truncateText:O}=e,{rows:y,sortBy:S,sortDirection:C}=B((t=>t.state)),{setRows:D,setSortBy:z,setSortDirection:k}=B((t=>t.actions)),I=o(null);return j((()=>{D(s)}),[s],b),n((()=>{L=s}),[]),t(u,Object.assign({component:null!=c?c:"div",sx:{height:"100%",width:"100%",display:"flex",flexDirection:"column"}},{children:[i($,{},void 0),t(p,Object.assign({sx:{minWidth:"300px",display:"flex",flexDirection:"column",...a},component:"div"},{children:[i(f,Object.assign({component:"div"},{children:i(m,Object.assign({sx:{display:"flex"},component:"div"},{children:r.map((({field:t,flex:e,width:o})=>i(v,Object.assign({sx:{flex:o||e?e:1,width:o,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},component:"div"},{children:i(d,Object.assign({sx:{display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%"}},{children:i(h,Object.assign({active:S===t,direction:C?"asc":"desc",onClick:()=>{((t,i)=>{var e;z(i),D(t?[...s].sort(((t,e)=>t[i]<e[i]?-1:e[i]<t[i]?1:0)):[...s].sort(((t,e)=>t[i]<e[i]?1:e[i]<t[i]?-1:0))),null===(e=I.current)||void 0===e||e.scrollToIndex({index:0})})(!C,t),k()}},{children:t.toString()}),void 0)}),void 0)}),t)))}),void 0)}),void 0),t(x,Object.assign({sx:{width:"100%",height:"100%",position:"relative"},component:"div"},{children:[l&&i(G,{},void 0),i(w,{height:"100%",width:"100%",ref:I,data:y,overscan:g,itemContent:(t,e)=>i(q,{columns:r,row:e,index:t,truncate:O},void 0)},void 0)]}),void 0)]}),void 0)]}),void 0)}),b);function $(){return t(d,Object.assign({sx:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",p:"5px"}},{children:[i(T,{},void 0),i(R,{},void 0),i(F,{},void 0)]}),void 0)}function G(){return i(g,{sx:{position:"absolute",top:"0px",width:"100%"}},void 0)}export{W as MuiDataTable};
