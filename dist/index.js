import{jsx as t,jsxs as e,Fragment as i}from"react/jsx-runtime";import{useState as o,useCallback as n,useEffect as r,memo as s,useRef as c}from"react";import{Box as d,IconButton as a,Button as l,TableRow as m,TableCell as v,TableContainer as u,Table as p,TableHead as f,TableSortLabel as h,TableBody as g,LinearProgress as x}from"@mui/material";import{dequal as b}from"dequal";import{useCustomCompareEffect as w}from"use-custom-compare";import{Virtuoso as j}from"react-virtuoso";import O from"zustand";import y from"zustand/context";import S from"immer";import C from"@mui/icons-material/Add";import D from"@mui/icons-material/Remove";import z from"@mui/icons-material/ImportExport";import{CSVLink as R}from"react-csv";import k from"@mui/icons-material/Visibility";import{createNewSortInstance as B}from"fast-sort";const{Provider:I,useStore:T,useStoreApi:F}=y(),M=()=>{return O((t=t=>({state:{rows:[],orgRows:[],fontSize:1,sortDirection:!1,sortBy:""},actions:{setFontSize:e=>t((t=>{t.state.fontSize=e(t.state.fontSize)})),setSortDirection:()=>t((t=>{t.state.sortDirection=!t.state.sortDirection})),setSortBy:e=>t((t=>{t.state.sortBy=e})),setRows:e=>t((t=>{t.state.rows=e})),setOrgRows:e=>t((t=>{t.state.orgRows=e}))}}),(e,i,o)=>t(((t,i)=>{const o="function"==typeof t?S(t):t;return e(o,i)}),i,o)));var t};function A({children:e}){return t(I,Object.assign({createStore:M},{children:e}),void 0)}const E=T,q=F;function G(){const{setFontSize:i}=E((t=>t.actions));return e(d,Object.assign({sx:{display:"flex",justifyContent:"space-around",alignItems:"center"}},{children:[t(a,Object.assign({onClick:()=>{i((t=>t+.1))}},{children:t(C,{},void 0)}),void 0),t(a,Object.assign({onClick:()=>{i((t=>t-.1))}},{children:t(D,{},void 0)}),void 0)]}),void 0)}function L(){const e=E((t=>t.state.rows));return t(d,{children:t(R,Object.assign({data:e,filename:"data-table-export",style:{textDecoration:"none"}},{children:t(l,Object.assign({variant:"text",endIcon:t(z,{},void 0),color:"primary"},{children:"Export"}),void 0)}),void 0)},void 0)}function N(){const{setSortBy:e,setRows:i,setFontSize:o}=E((t=>t.actions)),{getState:n}=q();return t(a,Object.assign({onClick:()=>{e(""),o((()=>1));const t=n().state.orgRows;!t||t.length<1||i(t)}},{children:t(k,{},void 0)}),void 0)}const P={cursor:"pointer",color:"#1b4394"};function V(s){const{lines:c=3,obj:d,lessText:a="Less",moreText:l="More"}=s,[m,v]=o(""),[u,p]=o(!0),[f,h]=o(null),g=n((t=>{if(!t)return;t.getClientRects().length<=c||h(Math.ceil(t.innerText.length/c))}),[c]);return r((()=>(W(d)&&v(d),()=>h(null))),[d]),m?e("span",Object.assign({ref:g},{children:[u&&f?m.substring(0,f):m,t("span",Object.assign({onClick:()=>p((t=>!t)),style:P},{children:f&&t(i,{children:u?"... "+l:" "+a},void 0)}),void 0)]}),void 0):d}const W=t=>"[object String]"===Object.prototype.toString.call(t),$=e=>{const{columns:o,row:n,index:r,truncate:s}=e,c=E((t=>t.state.fontSize)),d=(e,o)=>{const s=(null==n?void 0:n[e])?String(n[e]):"";return o?t(i,{children:o({index:r,value:s,row:n})},void 0):s};return t("div",Object.assign({style:{width:"100%",height:"100%"}},{children:t(m,Object.assign({sx:{display:"flex"},component:"div",hover:!0},{children:o.map((({field:e,flex:o,width:n,renderCell:r},a)=>t(v,Object.assign({component:"div",sx:{flex:n||o?o:1,width:n,wordBreak:"break-word"}},{children:t("div",Object.assign({style:{fontSize:`${c}em`}},{children:s?t(V,Object.assign({obj:d(e,r)},s),void 0):t(i,{children:d(e,r)},void 0)}),void 0)}),a)))}),void 0)}),void 0)},H=B({comparer:new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}).compare}),J={width:"100%",height:"100%"},K=s((i=>{const{columns:o,rows:n,component:r,loading:s,sx:a,overscanCount:l=0,truncateText:x}=i,{rows:O,sortBy:y,sortDirection:S}=E((t=>t.state)),{setOrgRows:C,setRows:D,setSortBy:z,setSortDirection:R}=E((t=>t.actions)),k=c(null);w((()=>{D(n),C(n)}),[n],b);return e(d,Object.assign({component:null!=r?r:"div",sx:{...J,display:"flex",flexDirection:"column"}},{children:[t(Q,{},void 0),t(u,Object.assign({sx:J,component:null!=r?r:"div"},{children:t(p,Object.assign({sx:{display:"flex",flexDirection:"column",...J,...a},component:"div"},{children:e(d,Object.assign({sx:{...J,minWidth:"max-content",display:"flex",flexDirection:"column"}},{children:[t(f,Object.assign({component:"div"},{children:t(m,Object.assign({sx:{display:"flex"},component:"div"},{children:o.map((({field:e,flex:i,width:o,headerName:r})=>t(v,Object.assign({sx:{flex:o||i?i:1,width:o,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},component:"div"},{children:t(h,Object.assign({active:y===e,direction:S?"asc":"desc",onClick:()=>{((t,e)=>{var i;z(e),D(t?H(n).asc((t=>t[e])):H(n).desc((t=>t[e]))),null===(i=k.current)||void 0===i||i.scrollToIndex({index:0})})(!S,e),R()}},{children:String(r)}),void 0)}),e)))}),void 0)}),void 0),e(g,Object.assign({sx:{...J,position:"relative"},component:"div"},{children:[s&&t(U,{},void 0),t(j,{height:"100%",width:"100%",ref:k,data:n.length!==O.length?n:O,overscan:l,itemContent:(e,i)=>t($,{columns:o,row:i,index:e,truncate:x},void 0)},void 0)]}),void 0)]}),void 0)}),void 0)}),void 0)]}),void 0)}),b);function Q(){return e(d,Object.assign({sx:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",p:"5px"}},{children:[t(L,{},void 0),t(G,{},void 0),t(N,{},void 0)]}),void 0)}function U(){return t(x,{sx:{position:"absolute",top:"0px",width:"100%"}},void 0)}function X({...e}){return t(A,{children:t(K,Object.assign({},e),void 0)},void 0)}export{X as MuiDataGrid};
