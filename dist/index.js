import{jsxs as t,jsx as e,Fragment as i}from"react/jsx-runtime";import{useState as n,useCallback as o,useEffect as r,memo as s,useRef as c}from"react";import{Box as d,IconButton as l,TableRow as a,TableCell as m,TableContainer as v,Table as u,TableHead as f,TableSortLabel as h,TableBody as p,LinearProgress as x}from"@mui/material";import{dequal as g}from"dequal";import{useCustomCompareEffect as b}from"use-custom-compare";import{Virtuoso as j}from"react-virtuoso";import w from"zustand";import O from"immer";import y from"@mui/icons-material/Add";import S from"@mui/icons-material/Remove";const C=w((D=t=>({state:{rows:[],fontSize:1,sortDirection:!1,sortBy:""},actions:{incrementFont:()=>t((t=>{t.state.fontSize+=.1})),decrementFont:()=>t((t=>{t.state.fontSize-=.1})),setSortDirection:()=>t((t=>{t.state.sortDirection=!t.state.sortDirection})),setSortBy:e=>t((t=>{t.state.sortBy=e})),setRows:e=>t((t=>{t.state.rows=e}))}}),(t,e,i)=>D(((e,i)=>{const n="function"==typeof e?O(e):e;return t(n,i)}),e,i)));var D;function k(){const{incrementFont:i,decrementFont:n}=C((t=>t.actions));return t(d,Object.assign({sx:{display:"flex",justifyContent:"space-around",alignItems:"center"}},{children:[e(l,Object.assign({onClick:i},{children:e(y,{},void 0)}),void 0),e(l,Object.assign({onClick:n},{children:e(S,{},void 0)}),void 0)]}),void 0)}const z={cursor:"pointer",color:"#1b4394"};function B(s){const{lines:c=3,obj:d,lessText:l="Less",moreText:a="More"}=s,[m,v]=n(""),[u,f]=n(!0),[h,p]=n(null),x=o((t=>{if(!t)return;t.getClientRects().length<=c||p(Math.ceil(t.innerText.length/c))}),[c]);return r((()=>{T(d)&&v(d)}),[d]),m?t("span",Object.assign({ref:x},{children:[u&&h?m.substring(0,h):m,e("span",Object.assign({onClick:()=>f((t=>!t)),style:z},{children:h&&e(i,{children:u?"... "+a:"... "+l},void 0)}),void 0)]}),void 0):d}const T=t=>"[object String]"===Object.prototype.toString.call(t),F=s((t=>{const{columns:n,row:o,index:r,truncate:s}=t,c=C((t=>t.state.fontSize)),d=(t,n)=>{var s,c;return n?e(i,{children:n({index:r,data:null!==(s=null==o?void 0:o[t])&&void 0!==s?s:""})},void 0):null===(c=null==o?void 0:o[t])||void 0===c?void 0:c.toString()};return e("div",Object.assign({style:{width:"100%",height:"100%"}},{children:e(a,Object.assign({sx:{display:"flex"},component:"div",hover:!0},{children:n.map((({field:t,flex:n,width:o,renderCell:r},l)=>e(m,Object.assign({component:"div",sx:{flex:o||n?n:1,width:o,wordBreak:"break-word"}},{children:e("div",Object.assign({style:{fontSize:`${c}em`}},{children:s?e(B,Object.assign({obj:d(t,r)},s),void 0):e(i,{children:d(t,r)},void 0)}),void 0)}),l)))}),void 0)}),void 0)}));function I(i){const{columns:n,rows:o,component:r,loading:s,sx:l,overscanCount:x=0,truncateText:w}=i,{rows:O,sortBy:y,sortDirection:S}=C((t=>t.state)),{setRows:D,setSortBy:k,setSortDirection:z}=C((t=>t.actions)),B=c(null);b((()=>{D(o)}),[o],g);return t(v,Object.assign({component:null!=r?r:"div",sx:{height:"100%",width:"100%",display:"flex",flexDirection:"column"}},{children:[e(R,{},void 0),t(u,Object.assign({sx:{minWidth:"300px",display:"flex",flexDirection:"column",...l},component:"div"},{children:[e(f,Object.assign({component:"div"},{children:e(a,Object.assign({sx:{display:"flex"},component:"div"},{children:n.map((({field:t,flex:i,width:n})=>e(m,Object.assign({sx:{flex:n||i?i:1,width:n,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},component:"div"},{children:e(d,Object.assign({sx:{display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%"}},{children:e(h,Object.assign({active:y===t,direction:S?"asc":"desc",onClick:()=>{((t,e)=>{var i;k(e),D(t?[...o].sort(((t,i)=>t[e]<i[e]?-1:i[e]<t[e]?1:0)):[...o].sort(((t,i)=>t[e]<i[e]?1:i[e]<t[e]?-1:0))),null===(i=B.current)||void 0===i||i.scrollToIndex({index:0})})(!S,t),z()}},{children:t.toString()}),void 0)}),void 0)}),t)))}),void 0)}),void 0),t(p,Object.assign({sx:{width:"100%",height:"100%",position:"relative"},component:"div"},{children:[s&&e(M,{},void 0),e(j,{height:"100%",width:"100%",ref:B,data:O,overscan:x,itemContent:(t,i)=>e(F,{columns:n,row:i,index:t,truncate:w},void 0)},void 0)]}),void 0)]}),void 0)]}),void 0)}function R(){return e(d,Object.assign({sx:{width:"100%",display:"flex",justifyContent:"flex-end",alignItems:"center"}},{children:e(k,{},void 0)}),void 0)}function M(){return e(x,{sx:{position:"absolute",top:"0px",width:"100%"}},void 0)}export{I as MuiDataTable};
