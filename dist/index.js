import{jsxs as t,jsx as e,Fragment as i}from"react/jsx-runtime";import{useRef as o,useEffect as n,useState as r,useCallback as s,memo as c}from"react";import{Box as d,IconButton as l,Button as a,TableRow as m,TableCell as v,TableContainer as p,Table as u,TableHead as f,TableSortLabel as h,TableBody as x,LinearProgress as g}from"@mui/material";import{dequal as b}from"dequal";import{useCustomCompareEffect as j}from"use-custom-compare";import{Virtuoso as w}from"react-virtuoso";import O from"zustand";import y from"immer";import S from"@mui/icons-material/Add";import C from"@mui/icons-material/Remove";import D from"@mui/icons-material/ImportExport";import{CSVLink as k}from"react-csv";const z=O((B=t=>({state:{rows:[],fontSize:1,sortDirection:!1,sortBy:""},actions:{incrementFont:()=>t((t=>{t.state.fontSize+=.1})),decrementFont:()=>t((t=>{t.state.fontSize-=.1})),setSortDirection:()=>t((t=>{t.state.sortDirection=!t.state.sortDirection})),setSortBy:e=>t((t=>{t.state.sortBy=e})),setRows:e=>t((t=>{t.state.rows=e}))}}),(t,e,i)=>B(((e,i)=>{const o="function"==typeof e?y(e):e;return t(o,i)}),e,i)));var B;function I(){const{incrementFont:i,decrementFont:o}=z((t=>t.actions));return t(d,Object.assign({sx:{display:"flex",justifyContent:"space-around",alignItems:"center"}},{children:[e(l,Object.assign({onClick:i},{children:e(S,{},void 0)}),void 0),e(l,Object.assign({onClick:o},{children:e(C,{},void 0)}),void 0)]}),void 0)}function T(){const t=o(z.getState().state.rows);return n((()=>z.subscribe((e=>t.current=e.state.rows))),[]),e(d,{children:e(k,Object.assign({data:t.current,filename:"data-table-export",style:{textDecoration:"none"}},{children:e(a,Object.assign({variant:"text",endIcon:e(D,{},void 0),color:"primary"},{children:"Export"}),void 0)}),void 0)},void 0)}const F={cursor:"pointer",color:"#1b4394"};function R(o){const{lines:c=3,obj:d,lessText:l="Less",moreText:a="More"}=o,[m,v]=r(""),[p,u]=r(!0),[f,h]=r(null),x=s((t=>{if(!t)return;t.getClientRects().length<=c||h(Math.ceil(t.innerText.length/c))}),[c]);return n((()=>{E(d)&&v(d)}),[d]),m?t("span",Object.assign({ref:x},{children:[p&&f?m.substring(0,f):m,e("span",Object.assign({onClick:()=>u((t=>!t)),style:F},{children:f&&e(i,{children:p?"... "+a:"... "+l},void 0)}),void 0)]}),void 0):d}const E=t=>"[object String]"===Object.prototype.toString.call(t),M=c((t=>{const{columns:o,row:n,index:r,truncate:s}=t,c=z((t=>t.state.fontSize)),d=(t,o)=>{var s,c;return o?e(i,{children:o({index:r,data:null!==(s=null==n?void 0:n[t])&&void 0!==s?s:""})},void 0):null===(c=null==n?void 0:n[t])||void 0===c?void 0:c.toString()};return e("div",Object.assign({style:{width:"100%",height:"100%"}},{children:e(m,Object.assign({sx:{display:"flex"},component:"div",hover:!0},{children:o.map((({field:t,flex:o,width:n,renderCell:r},l)=>e(v,Object.assign({component:"div",sx:{flex:n||o?o:1,width:n,wordBreak:"break-word"}},{children:e("div",Object.assign({style:{fontSize:`${c}em`}},{children:s?e(R,Object.assign({obj:d(t,r)},s),void 0):e(i,{children:d(t,r)},void 0)}),void 0)}),l)))}),void 0)}),void 0)}));function q(i){const{columns:n,rows:r,component:s,loading:c,sx:l,overscanCount:a=0,truncateText:g}=i,{rows:O,sortBy:y,sortDirection:S}=z((t=>t.state)),{setRows:C,setSortBy:D,setSortDirection:k}=z((t=>t.actions)),B=o(null);j((()=>{C(r)}),[r],b);return t(p,Object.assign({component:null!=s?s:"div",sx:{height:"100%",width:"100%",display:"flex",flexDirection:"column"}},{children:[e(A,{},void 0),t(u,Object.assign({sx:{minWidth:"300px",display:"flex",flexDirection:"column",...l},component:"div"},{children:[e(f,Object.assign({component:"div"},{children:e(m,Object.assign({sx:{display:"flex"},component:"div"},{children:n.map((({field:t,flex:i,width:o})=>e(v,Object.assign({sx:{flex:o||i?i:1,width:o,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},component:"div"},{children:e(d,Object.assign({sx:{display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%"}},{children:e(h,Object.assign({active:y===t,direction:S?"asc":"desc",onClick:()=>{((t,e)=>{var i;D(e),C(t?[...r].sort(((t,i)=>t[e]<i[e]?-1:i[e]<t[e]?1:0)):[...r].sort(((t,i)=>t[e]<i[e]?1:i[e]<t[e]?-1:0))),null===(i=B.current)||void 0===i||i.scrollToIndex({index:0})})(!S,t),k()}},{children:t.toString()}),void 0)}),void 0)}),t)))}),void 0)}),void 0),t(x,Object.assign({sx:{width:"100%",height:"100%",position:"relative"},component:"div"},{children:[c&&e(L,{},void 0),e(w,{height:"100%",width:"100%",ref:B,data:O,overscan:a,itemContent:(t,i)=>e(M,{columns:n,row:i,index:t,truncate:g},void 0)},void 0)]}),void 0)]}),void 0)]}),void 0)}function A(){return t(d,Object.assign({sx:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",p:"5px"}},{children:[e(T,{},void 0),e(I,{},void 0)]}),void 0)}function L(){return e(g,{sx:{position:"absolute",top:"0px",width:"100%"}},void 0)}export{q as MuiDataTable};
