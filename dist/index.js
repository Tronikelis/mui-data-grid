import{jsx as t,jsxs as e,Fragment as i}from"react/jsx-runtime";import{useRef as o,useEffect as n,useState as r,useCallback as s,memo as c}from"react";import{Box as d,IconButton as l,Button as a,TableRow as m,TableCell as v,TableContainer as u,Table as h,TableHead as p,TableSortLabel as f,TableBody as x,LinearProgress as g}from"@mui/material";import{dequal as b}from"dequal";import{useCustomCompareEffect as j}from"use-custom-compare";import{Virtuoso as w}from"react-virtuoso";import O from"zustand";import y from"zustand/context";import S from"immer";import C from"@mui/icons-material/Add";import z from"@mui/icons-material/Remove";import D from"@mui/icons-material/ImportExport";import{CSVLink as k}from"react-csv";import B from"@mui/icons-material/RestartAlt";const{Provider:I,useStore:R,useStoreApi:T}=y(),A=()=>{return O((t=t=>({state:{rows:[],fontSize:1,sortDirection:!1,sortBy:""},actions:{setFontSize:e=>t((t=>{t.state.fontSize=e(t.state.fontSize)})),setSortDirection:()=>t((t=>{t.state.sortDirection=!t.state.sortDirection})),setSortBy:e=>t((t=>{t.state.sortBy=e})),setRows:e=>t((t=>{t.state.rows=e}))}}),(e,i,o)=>t(((t,i)=>{const o="function"==typeof t?S(t):t;return e(o,i)}),i,o)));var t};function F({children:e}){return t(I,Object.assign({createStore:A},{children:e}),void 0)}const M=R,E=T;function q(){const{setFontSize:i}=M((t=>t.actions));return e(d,Object.assign({sx:{display:"flex",justifyContent:"space-around",alignItems:"center"}},{children:[t(l,Object.assign({onClick:()=>{i((t=>t+.1))}},{children:t(C,{},void 0)}),void 0),t(l,Object.assign({onClick:()=>{i((t=>t-.1))}},{children:t(z,{},void 0)}),void 0)]}),void 0)}function L(){const{getState:e,subscribe:i}=E(),r=o(e().state.rows);return n((()=>i((t=>r.current=t.state.rows))),[]),t(d,{children:t(k,Object.assign({data:r.current,filename:"data-table-export",style:{textDecoration:"none"}},{children:t(a,Object.assign({variant:"text",endIcon:t(D,{},void 0),color:"primary"},{children:"Export"}),void 0)}),void 0)},void 0)}function N(){const{setSortBy:e,setRows:i,setFontSize:o}=M((t=>t.actions));return t(l,Object.assign({onClick:()=>{e(""),o((()=>1)),H&&i(H)}},{children:t(B,{},void 0)}),void 0)}const P={cursor:"pointer",color:"#1b4394"};function W(o){const{lines:c=3,obj:d,lessText:l="Less",moreText:a="More"}=o,[m,v]=r(""),[u,h]=r(!0),[p,f]=r(null),x=s((t=>{if(!t)return;t.getClientRects().length<=c||f(Math.ceil(t.innerText.length/c))}),[c]);return n((()=>{$(d)&&v(d)}),[d]),m?e("span",Object.assign({ref:x},{children:[u&&p?m.substring(0,p):m,t("span",Object.assign({onClick:()=>h((t=>!t)),style:P},{children:p&&t(i,{children:u?"... "+a:"... "+l},void 0)}),void 0)]}),void 0):d}const $=t=>"[object String]"===Object.prototype.toString.call(t),G=c((e=>{const{columns:o,row:n,index:r,truncate:s}=e,c=M((t=>t.state.fontSize)),d=(e,o)=>{var s,c,d;return o?t(i,{children:o({index:r,data:null!==(s=null==n?void 0:n[e])&&void 0!==s?s:""})},void 0):null!==(d=null===(c=null==n?void 0:n[e])||void 0===c?void 0:c.toString())&&void 0!==d?d:""};return t("div",Object.assign({style:{width:"100%",height:"100%"}},{children:t(m,Object.assign({sx:{display:"flex"},component:"div",hover:!0},{children:o.map((({field:e,flex:o,width:n,renderCell:r},l)=>t(v,Object.assign({component:"div",sx:{flex:n||o?o:1,width:n,wordBreak:"break-word"}},{children:t("div",Object.assign({style:{fontSize:`${c}em`}},{children:s?t(W,Object.assign({obj:d(e,r)},s),void 0):t(i,{children:d(e,r)},void 0)}),void 0)}),l)))}),void 0)}),void 0)}));let H=null;const J=c((i=>{const{columns:r,rows:s,component:c,loading:l,sx:a,overscanCount:g=0,truncateText:O}=i,{rows:y,sortBy:S,sortDirection:C}=M((t=>t.state)),{setRows:z,setSortBy:D,setSortDirection:k}=M((t=>t.actions)),B=o(null);j((()=>{z(s)}),[s],b),n((()=>{H=s}),[]);return e(u,Object.assign({component:null!=c?c:"div",sx:{height:"100%",width:"100%",display:"flex",flexDirection:"column"}},{children:[t(K,{},void 0),e(h,Object.assign({sx:{minWidth:"300px",display:"flex",flexDirection:"column",width:"100%",height:"100%",...a},component:"div"},{children:[t(p,Object.assign({component:"div"},{children:t(m,Object.assign({sx:{display:"flex"},component:"div"},{children:r.map((({field:e,flex:i,width:o,headerName:n})=>t(v,Object.assign({sx:{flex:o||i?i:1,width:o,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},component:"div"},{children:t(d,Object.assign({sx:{display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%"}},{children:t(f,Object.assign({active:S===e,direction:C?"asc":"desc",onClick:()=>{((t,e)=>{var i;D(e),z(t?[...s].sort(((t,i)=>t[e]<i[e]?-1:i[e]<t[e]?1:0)):[...s].sort(((t,i)=>t[e]<i[e]?1:i[e]<t[e]?-1:0))),null===(i=B.current)||void 0===i||i.scrollToIndex({index:0})})(!C,e),k()}},{children:n.toString()}),void 0)}),void 0)}),e)))}),void 0)}),void 0),e(x,Object.assign({sx:{width:"100%",height:"100%",position:"relative"},component:"div"},{children:[l&&t(Q,{},void 0),t(w,{height:"100%",width:"100%",ref:B,data:y,overscan:g,itemContent:(e,i)=>t(G,{columns:r,row:i,index:e,truncate:O},void 0)},void 0)]}),void 0)]}),void 0)]}),void 0)}),b);function K(){return e(d,Object.assign({sx:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",p:"5px"}},{children:[t(L,{},void 0),t(q,{},void 0),t(N,{},void 0)]}),void 0)}function Q(){return t(g,{sx:{position:"absolute",top:"0px",width:"100%"}},void 0)}function U({...e}){return t(F,{children:t(J,Object.assign({},e),void 0)},void 0)}export{U as MuiDataTable};
